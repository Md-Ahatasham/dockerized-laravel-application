pipeline {
   agent any

   parameters {
     booleanParam(name: 'RUN_COMPOSER_INSTALL', defaultValue: false, description: 'Run composer install command')
     booleanParam(name: 'RUN_DATABASE_MIGRATION', defaultValue: false, description: 'Run php artisan migrate:fresh command')
     booleanParam(name: 'RUN_DATABASE_SEEDER', defaultValue: false, description: 'Run php artisan db:seed command')
     booleanParam(name: 'RUN_NPM_INSTALL', defaultValue: false, description: 'Run npm install command')
   }

   environment {
     GIT_REPO = 'https://github.com/Md-Ahatasham/dockerized-laravel-application.git'
     GIT_BRANCH = 'feature/deploy-to-remote-server'
     DOCKER_COMPOSE_FILE = 'docker/docker-compose.yml'
     REMOTE_HOST = 'sham@192.168.0.103'
     DOCKER_DIR = '/home/sham/docker-app'
     SSH_CREDENTIAL_KEY = 'remotesshkey'
   }

   stages {
       stage('checkout') {
         steps {
           git branch: "${env.GIT_BRANCH}", url: "${env.GIT_REPO}"
         }
       }

      stage('Deploy') {
        steps {
          script {
              sshagent([env.SSH_CREDENTIAL_KEY]) {
                  // Ensure the directory exists on the remote server
//                   sh "ssh ${env.REMOTE_HOST} 'mkdir -p ${env.DOCKER_DIR}'"
                  sh "ssh -vvv ${env.REMOTE_HOST} 'mkdir -p ${env.DOCKER_DIR}'"
              }
          }
        }
      }
   }
}
